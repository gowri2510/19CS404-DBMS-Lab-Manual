# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
--From the following tables, write a SQL query to find all the orders issued by the salesman 'Paul Adam'. Return ord_no, purch_amt, ord_date, customer_id and salesman_id.

salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int

```sql
-- select o.ord_no, o.purch_amt, o.ord_date, o.customer_id,o.salesman_id
from orders o
join salesman s
on o.salesman_id=s.salesman_id
where s.name='Paul Adam';
```

**Output:**

!![{C077050B-F3F7-45F3-8F8F-37A0FE9FC184}](https://github.com/user-attachments/assets/b32f88cc-9af2-4f60-824f-c5339f8b7385)


**Question 2**
---
--Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose AGE is LESS than $30

Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh     32              Ahmedabad     2000
2          Khilan        25              Delhi                 1500
3          Kaushik      23              Kota                  2000
4          Chaitali       25             Mumbai            6500
5          Hardik        27              Bhopal              8500
6          Komal         22              Hyderabad       4500

7           Muffy          24              Indore            10000

```sql
--select * from CUSTOMERS
where age<30;
```

**Output:**

!![{DF5BF0C7-154E-4CBB-9BBF-325CEFCF24FB}](https://github.com/user-attachments/assets/554ab492-9e13-4fec-8f84-f8441e13c311)


**Question 3**
---
-- Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the maximum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)
![{34B67CA6-BB0F-4426-957A-3B1CD0CC4315}](https://github.com/user-attachments/assets/d26a44b9-180b-438c-9921-091ceb05b7bc)


```sql
--select student_name ,grade from grades as g1
where grade =(select MAX(grade) from grades as g2 where g1.subject=g2.subject);
```

**Output:**

!![{238FF4C0-7B59-4334-A7F7-99F8A51FB51F}](https://github.com/user-attachments/assets/e97abdb7-adab-4b57-9b9f-3aedf7e34511)


**Question 4**
---
-- Write a SQL query to List departments with names longer than the average length

Departments Table (attributes: department_id, department_name)
![{5562732A-21D5-482F-A5D1-0E7365733353}](https://github.com/user-attachments/assets/cffd22f5-0ff8-44ab-af6a-5227f8ca4faa)


```sql
-- select department_id as depar, department_name
from Departments 
where  length(department_name)>(select avg(length(department_name))from Departments);
```

**Output:**

!![{C675862F-FC9C-4DBC-8DAE-3736D964EDE3}](https://github.com/user-attachments/assets/49537921-3228-4bcd-8954-34cda6bffae5)


**Question 5**
---
-- From the following tables write a SQL query to find all orders generated by New York-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int

```sql
-- select o.ord_no, o.purch_amt, o.ord_date, o.customer_id, o.salesman_id
from orders o
join salesman s
on o.salesman_id=s.salesman_id
where city='New York';

```

**Output:**

!![{E4591434-FB5E-42C3-9727-DE4815BD1BA9}](https://github.com/user-attachments/assets/3328f007-eac4-49cb-b05d-dae5194308fd)


**Question 6**
---
-- Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $4500.

Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh     32              Ahmedabad     2000
2          Khilan        25              Delhi                 1500
3          Kaushik      23              Kota                  2000
4          Chaitali       25             Mumbai            6500
5          Hardik        27              Bhopal              8500
6          Komal         22              Hyderabad       4500

7           Muffy          24              Indore            10000

```sql
--select * from CUSTOMERS
where salary>4500;
```

**Output:**

!![{9F48CE76-68F4-4B6A-A873-34461C285667}](https://github.com/user-attachments/assets/d469d06a-35b0-43a1-853b-ec2abcea4d17)


**Question 7**
---
--Write a query to display all the customers whose ID is the difference between the salesperson ID of Mc Lyon and 2001.

salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

customer table

name         type
-----------  ----------
customer_id  int
cust_name    text
city         text
grade        int
salesman_id  int
 

```sql
--select * from customer
where customer_id=(select(salesman_id-2001) from salesman where name='Mc Lyon');
```

**Output:**

!![{81BA5988-2C42-42CF-ADE8-8B4F21F4B8DE}](https://github.com/user-attachments/assets/382662c7-6dcc-4d5f-83b8-765d33dfae29)


**Question 8**
---
-- Write a SQL query to Retrieve the names and cities of customers who have the same city as customers with IDs 3 and 7

SAMPLE TABLE: customer

name             type
---------------  ---------------
id               INTEGER
name             TEXT
city             TEXT
email            TEXT
phone            INTEGER


```sql
-- select name,city
from customer
where city in (select(city)from customer where id in(3,7));
```

**Output:**

!![{7B88612D-BD79-4345-A731-392F2A422097}](https://github.com/user-attachments/assets/a7fb3566-7439-47e5-b009-86a231485d53)

**Question 9**
---
-- From the following tables write a SQL query to find salespeople who had more than one customer. Return salesman_id and name.

salesman table

name                 type
---------------   ---------------
salesman_id       numeric(5)
name                  varchar(30)
city                     varchar(15)
commission       decimal(5,2)

customer table

name              type
-----------       ----------
customer_id   int
cust_name     text
city                text
grade            int
salesman_id  int

```sql
--select s.salesman_id,s.name
from salesman s
join customer c
on s.salesman_id=c.salesman_id
group by s.salesman_id,s.name
having count(c.customer_id)>1;
```

**Output:**

!![{41765DFA-D6F6-415C-930C-29E72FEB0B11}](https://github.com/user-attachments/assets/1687089b-1f07-4f71-8966-0a39e5f5dcb6)


**Question 10**
---
-- From the following tables write a SQL query to count the number of customers with grades above the average in New York City. Return grade and count.

customer table

name         type
-----------  ----------
customer_id  int
cust_name    text
city         text
grade        int
salesman_id  int
```sql
-- select grade,COUNT(*)
from customer
where grade>(select avg(grade) from customer where city='New York')
group by grade;
```

**Output:**

!![{BD4F6961-8C3A-483B-909D-5EDF9E280A1C}](https://github.com/user-attachments/assets/2dfece43-a7dd-4afa-b2ed-864095c62e09)

 **Module 4 SEB grade:
 ![{CF093F8C-335C-4619-A1BF-B35920FE5922}](https://github.com/user-attachments/assets/ffa0724b-4990-409f-b337-7d956c1e785b)

!Result:
Thus ,subqueries and views is verified.


## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
